---
title: "Les passagers du Titanic"
format:
  html:
    toc: true
    toc-depth: 3
    theme: cosmo
    number-sections: true
    code-fold: true          # cacher les chunks par d√©faut (avec bouton pour les afficher)
    code-summary: "Afficher le code"  # bouton dans le HTML
knitr:
  opts_chunk:
    echo: false              # cache le code R
    message: false           # cache les messages
    warning: false           # cache les warnings
    error: false             # cache les erreurs
editor: visual
editor_options: 
  chunk_output_type: inline
---

```{r}
# install.packages("titanic")  # Si ce n'est pas d√©j√† fait
library(titanic)
train_set <- titanic_train
test_set <- titanic_test
```

```{r}
library(dplyr)
library(tidyverse)
library(forcats)
library(showtext)
library(hrbrthemes)
library(rcompanion)
library(scales)
```

```{r}
df <- bind_rows(train_set,test_set) # combiner les deux donn√©es pour former un seul data set
df <- df |> 
  mutate(
    Survived = as_factor(Survived),
    Survie_Na = fct_explicit_na(Survived,"Informations inconnues")
  )
```

```{r}


# Remplace les chemins par ceux que tu trouves dans font_files()
font_add("Segoe",    "C:/Windows/Fonts/segoeui.ttf")
font_add("Times New Roman",    "C:/Windows/Fonts/times.ttf")
font_add("Georgia",  "C:/Windows/Fonts/georgia.ttf")
# font_add("Garamond", "C:/Windows/Fonts/garamond.ttf")
font_add("Calibri","C:/Windows/Fonts/calibri.ttf" )
showtext_auto()


# font_files()
bf <- "Calibri"
tf <- "Times New Roman"
theme <-   theme_ipsum(base_family = bf,plot_title_family = tf)


ggt <- geom_text(stat="count",
            aes(
              label=scales::percent(
                                    after_stat(count)/nrow(df)
                                    )
              ),
            vjust=-0.5
            )
```

```{r}

# table(df$Parch)
# table(df$SibSp)
df <- df |> mutate(across(c(Survived, Pclass, Sex, Embarked), as.factor))

# colnames(df) 
```

# Pr√©sentation

Cette √©tude s‚Äôinscrit dans le cadre d‚Äôun projet d‚Äôanalyse de donn√©es portant sur le naufrage du **`Titanic`**, l‚Äôun des accidents maritimes les plus marquants du XXe si√®cle. √Ä partir d‚Äôun jeu de donn√©es rendu c√©l√®bre par la plateforme **`Kaggle`**, contenant des informations d√©taill√©es sur les passagers (√¢ge, sexe, classe sociale, prix du billet, embarquement, etc.), l‚Äôobjectif est de **mener une analyse exploratoire approfondie** afin de comprendre **les facteurs ayant influenc√© la probabilit√© de survie**.\

L‚Äôenjeu est double : d‚Äôune part, **identifier des liens statistiques entre certaines caract√©ristiques individuelles et la survie** (via tests d‚Äôind√©pendance, visualisations, mesures d‚Äôasym√©trie, etc.) ; d‚Äôautre part, **d√©velopper un mod√®le de classification supervis√©e** capable de **pr√©dire si un passager aurait surv√©cu ou non** √† partir de ses attributs.\

Ce projet permet ainsi de combiner une approche **exploratoire, statistique et pr√©dictive**, tout en illustrant des probl√©matiques r√©elles d‚Äôin√©galit√©s sociales, de logistique de sauvetage et de mod√©lisation en Machine Learning

![](images/clipboard-1996632301.png){width="949"}

## Description du jeu de donn√©e

Ce jeu de donn√©es est compos√© de **1309 observations** et de **12 variables**, dont :

-   **2 variables de type caract√®re** : `Name` et `Cabin`
-   **5 variables cat√©gorielles** : `Pclass`, `Survived`, `Sex`, `Embarked`, et `Ticket` (selon traitement)
-   **2 variables num√©riques continues** : `Age` et `Fare`
-   **2 variables num√©riques discr√®tes** : `SibSp` et `Parch`
-   **1 identifiant** : `PassengerId` (non utilis√© pour l‚Äôanalyse)

+---------------+---------------------------------------------------------------------------------+
| Variables     | Explication                                                                     |
+===============+=================================================================================+
| `PassengerId` | |                                                           |                   |
|               | |-----------------------------------------------------------|                   |
|               | | Identifiant unique pour chaque passager (num√©ro de ligne) |                   |
+---------------+---------------------------------------------------------------------------------+
| `Survived`    | **Statut de survie** : `1 = a surv√©cu`, `0 = d√©c√©d√©`                            |
+---------------+---------------------------------------------------------------------------------+
| `Pclass`      | **Classe du billet** (cat√©gorie socio-√©co) : `1 = 1√®re`, `2 = 2√®me`, `3 = 3√®me` |
+---------------+---------------------------------------------------------------------------------+
| `Name`        | Nom complet du passager (inclut le titre : Mr., Mrs., etc.)                     |
+---------------+---------------------------------------------------------------------------------+
| `SEX`         | **Sexe** du passager                                                            |
+---------------+---------------------------------------------------------------------------------+
| `Age`         | **√Çge** du passagers                                                            |
+---------------+---------------------------------------------------------------------------------+
| `Sibsp`       | Nombre de fr√®re et s≈ìur et/ou de conjoint a bord                                |
+---------------+---------------------------------------------------------------------------------+
| `parch`       | Nombre de **parents et/ou enfants** a bord                                      |
+---------------+---------------------------------------------------------------------------------+
| `Ticket`      | Num√©ro de **billet**                                                            |
+---------------+---------------------------------------------------------------------------------+
| `Fare`        | **Tarif pay√© pour le billet en ¬£**                                              |
+---------------+---------------------------------------------------------------------------------+
| `Cabin`       | Num√©ro de **cabine**                                                            |
+---------------+---------------------------------------------------------------------------------+
| `Embarked`    | Port d'**embarquement**                                                         |
|               |                                                                                 |
|               | -   `C = Cherbourg`                                                             |
|               |                                                                                 |
|               | -   `Q = Queenstown`                                                            |
|               |                                                                                 |
|               | -   `S = Southampton`                                                           |
+---------------+---------------------------------------------------------------------------------+

```{r}
# library(echarts4r)
# 
# # Cr√©er la table des classes avec les variables
# Class <- as.data.frame(sapply(df, class)) |>
#   rownames_to_column(var = "Variable") |>
#   rename(Classe = `sapply(df, class)`)
# 
# # R√©sum√© avec noms de variables concat√©n√©s
# summary_class <- Class |>
#   group_by(Classe) |>
#   summarise(
#     count = n(),
#     Variables = paste(Variable, collapse = ", ")
#   )
# 
# # Cr√©ation du graphique avec tooltip custom
# summary_class |> ungroup() |>
#   e_charts(Classe) |>
#   e_bar(
#     count,
#     name = "Nombre de variables",
#     colorBy="data") |>
#   e_tooltip(trigger = "axis"
#     # formatter = htmlwidgets::JS("
#     #   function(params) {
#     #     return '<b>Classe :</b> ' + params.name + '<br/>' +
#     #            '<b>Nombre :</b> ' + params.value + '<br/>' +
#     #            '<b>Variables :</b> ' + params.data.Variables;
#     #   }
#     # ")
#  )

```

# EDA

Apr√®s avoir d√©crit la structure et le contenu du jeu de donn√©es, nous allons maintenant proc√©der √† une **analyse exploratoire des donn√©es** (EDA), afin de mieux comprendre les principales tendances, distributions, et relations entre les variables.

```{r,fig.cap= "{Table-1} Table des 10 1er valeurs du jeu de donn√©es"}
library(kableExtra)
df |> head(10) |> 
  kbl(
    caption = "Pr√©sentation du jeu de donn√©es"
    # format = "rst"
    
  )|> 
  kable_styling() |>
  column_spec(column = 2,
              background = "#FFFABC",
              color = "black") |> 
  row_spec(row = 0,
           underline = TRUE,
           italic = T)
```

Y'a-t-il des donn√©es manquantes ?

Avant de proc√©der √† l‚Äôanalyse ou √† la mod√©lisation, il est essentiel d‚Äôidentifier la pr√©sence de **valeurs manquantes** dans le jeu de donn√©es.\

Le graphique ci-dessous permet de **visualiser rapidement les variables concern√©es par des donn√©es manquantes**, ainsi que leur **proportion relative**.\

Cette √©tape est indispensable pour anticiper les traitements n√©cessaires en phase de pr√©paration des donn√©es.

```{r,fig.cap= "figure :2 : Tableau r√©capitulatif des valeurs manquantes par variables"}
library(naniar)
gg_miss_var(df) +
  labs( y ="Nombres de valeurs manquantes",
        title = "Tableau des valeurs manquantes par variables")+
  theme+
  theme(plot.title.position = "plot")
```

La variable `Survivant ,Age et Fare` poss√®dent des valeurs manquantes respectivement (418,263 et 1) le fait d'avoir des donn√©es manquantes peut √™tre probl√©matique dans le sens ou si on ne g√®re pas ces donn√©es manquantes on risquerait de perdre des informations car ces valeurs manquantes touche 52,1% des donn√©es .

Nous allons voir plus en d√©tails comment g√©r√© ses valeurs manquantes .

### R√©sume statstatistiques des variables **`Fare`** (Prix du billet ) et `Age`

Un **r√©sum√© statistique** permet de mettre en √©vidence les **tendances centrales** (telles que la moyenne et la m√©diane) de chaque variable et les m√©sure de disperesion (variance , √©cart-type) tout en donnant une premi√®re id√©e de la **distribution des donn√©es**.\

Il permet √©galement de d√©tecter la **dispersion**, les **asym√©tries** √©ventuelles, ainsi que la **pr√©sence de valeurs aberrantes** (outliers) qui pourraient influencer les analyses futures.

```{r}
library(gt)
TB <- psych::describe(df |> select(Age , Fare))
TB[,1] <- colnames(df |> select(Age , Fare))

# Renommer les colonnes en fran√ßais
colnames(TB) <- c("Variable", "Nb_obs", "Moyenne", "√âcart_type", "M√©diane", "Tr_Moyenne","mad",
                   "Minimum", "Maximum", "√âtendu","Asym√©trie", "Curtosis", "SE")

Color <- c("#FDE725FF", "#21908CFF")

TB |> 
  select(- Nb_obs) |> 
  mutate(across(where(is.numeric),round,digits=2 )) |>
  gt() |> 
  tab_header(title = md("*R√©sum√© statistiques des variable numerique continue*")) |> 
  tab_style(
    locations = cells_body(
      columns = "Variable",
      rows = everything()
    ),
    style = cell_fill(color=Color[2])
  ) |> 
  # tab_style(
  #   locations = cells_body(
  #     columns = everything(),
  #     rows = 2
  #   ),
  #   style = cell_fill(color=Color[1])
  # ) |> 
  tab_footnote(
    locations = list(cells_column_labels(columns = "Curtosis")),
     footnote = md("**Aplatissement de la distribution** : \n
    - Valeur proche de 0 : Distribution normale. \n
    - Valeur > 0 : Distribution plus pointue. \n
    - Valeur < 0 : Distribution plus aplatie. \n "
  ) )|> 
   tab_footnote(
    locations = cells_column_labels(columns = "Tr_Moyenne"),
    footnote = md("**La moyenne tronqu√©e est une moyenne calcul√©e apr√®s avoir supprim√© 
    un certain pourcentage des valeurs extr√™mes** (les plus grandes et les plus petites)")
  ) |>  tab_footnote(
    locations = cells_column_labels(columns = "mad"),
    footnote = md("**Mediane des ecart a la m√©diane** \n
    - Un mad √©lev√© signifie une forte dispersion autour de la m√©diane.\n
    - Un mad proche de 0 indique que les valeurs sont tr√®s regroup√©es autour de la m√©diane.")
  )

```

Le tableau ci-dessous nous indique que **l‚Äô√¢ge moyen des passagers est de 29,88 ans**. Le plus jeune avait **2 mois**, tandis que le plus √¢g√© avait **80 ans**.\
La distribution de l‚Äô√¢ge semble **relativement √©quilibr√©e**, avec une **asym√©trie mod√©r√©e √† droite (skewness = 0,41)** et une **kurtosis de 0,13**, ce qui sugg√®re une forme **proche d‚Äôune distribution normale**, sans aplatissement ou concentration excessifs.

Concernant la variable **`Fare` (prix des billets)**, la **moyenne est de 33,30 ¬£**, avec un **√©cart-type √©lev√© de 51,76 ¬£**, ce qui pourrait laisser penser √† une forte dispersion.\
Cependant, cette dispersion apparente est principalement due √† la pr√©sence de **valeurs aberrantes** (tr√®s gros montants). Cela est confirm√© par le fait que la **moyenne tronqu√©e** (c‚Äôest-√†-dire la moyenne calcul√©e apr√®s exclusion des valeurs extr√™mes) chute √† **21,57 ¬£**, soit une **diff√©rence notable de plus de 11 ¬£** avec la moyenne classique.

De plus, la distribution de `Fare` est **tr√®s asym√©trique √† droite** (**skewness = 4,31**) et **extr√™mement `leptokurtique`** (**kurtosis = 26,87**), ce qui indique une **concentration √©lev√©e autour des petits montants** et la pr√©sence de **billets tr√®s co√ªteux** (jusqu‚Äô√† **512,33 ¬£**) qui d√©forment la moyenne.\
Ainsi, bien que l‚Äô√©cart-type soit √©lev√©, la variabilit√© r√©elle per√ßue pour la majorit√© des passagers est **moins importante** que ce que la moyenne brute laisse entendre.

## Analyse individuel des variables

### La variable **`Sex`**

Commen√ßons avec le genre des passagers, passons en revue la r√©partition du genre en fonction des passagers :

On observe que 36% des passagers sont des femmes et 64 % des hommes

```{r}


df |> 
  count(Sex) |> 
  mutate(prop = n / sum(n)) |> 
  ggplot(aes(x = "", y = prop, fill = Sex)) +
  geom_col(width = 1, color = "white") +
  coord_polar(theta = "y") +
  scale_fill_viridis_d()+
  geom_text(aes(label = percent(prop, accuracy = 1)),
            position = position_stack(vjust = 0.5), color = "white", fontface = "bold") +
  labs(title = "R√©partition des sexes parmi les passagers",
       x = NULL, y = NULL) +
  theme_void() +
  theme(legend.position = "right")

```

```{r}
 # colSums(is.na(df))/ nrow(df) |> round(digits = 3)
# is.na(df) |> sum() /nrow(df)
```

```{r}
# str(df)

```

### Analyse partielle de variable **`Survived`**

```{r}
library(showtext)

showtext_auto()
```

La variable **`Survived`** constitue la **variable cible** de notre √©tude, celle que nous chercherons √† **pr√©dire dans les analyses futures**. Elle indique si un passager a **surv√©cu (`1`)** ou **non (`0`)** au naufrage du **`Titanic`**.\

Le graphique ci-dessous illustre la **r√©partition des passagers selon leur statut**, permettant ainsi d‚Äôavoir une **premi√®re vue d‚Äôensemble sur l‚Äô√©quilibre ou le d√©s√©quilibre** de cette variable cible dans l‚Äô√©chantillon

```{r,fig.cap="Figure 2 : R√©partition des passagers selon leur statut"}



df |> 
  mutate(
    Survived = case_when(
      Survived == 1 ~ "Survivants",      
      Survived == 0 ~ "D√©c√©d√©s",
      TRUE ~ NA_character_
    ),
    Survived = fct_explicit_na(Survived, na_level = "Informations manquantes"),
    Survived = fct_reorder(Survived, Survived, .fun = function(x) length(x), .desc = TRUE)  # ordre croissant
  ) |>
  ggplot(aes(x = Survived, fill = Survived)) +
  geom_bar() +
  # scale_fill_brewer(palette = "Dark2") +
  scale_fill_viridis_d()+
  labs(
    title = "R√©partition des statuts des passagers ", 
    x = "Statut", 
    y = "Nombre",
    fill="Statut "
  ) +
   geom_text(stat = "count", aes(label =scales::percent( after_stat(count)/nrow(df))), vjust = -0.5) +  # üè∑Ô∏è labels automatiques  
  theme_ipsum(base_family = "serif")
  

# 
# idis::viridis_pal()(10)
#  [1] "#440154FF" "#482878FF" "#3E4A89FF"
#  [4] "#31688EFF" "#26828EFF" "#1F9E89FF"
#  [7] "#35B779FF" "#6DCD59FF" "#B4DE2CFF"
# [10] "#FDE725FF"
# 
#  "#A1307EFF" "#BB3878FF" "#D3436EFF"
#  [4] "#E85362FF" "#F66C5CFF" "#FC8A62FF"
#  [7] "#FEA872FF" "#FEC488FF" "#FDE1A2FF"
# [10] "#FCFDBFFF"

Colors <- c( "#440154FF","#35B779FF","#FDE725FF","#FCFDBFFF","#FC8A62FF")
```

Lors de la d√©compte on observe que 41.9 % des passagers sont d√©c√©d√©s ,26.1% sont des survivants.

Pour **le reste des individus**, aucune information sur leur sort n‚Äôest disponible. Il est donc probable qu‚Äôils soient **port√©s disparus** ou que l‚Äôinformation ait √©t√© **non collect√©e ou perdue**, ce qui justifie leur traitement en tant que **valeurs manquantes ou ind√©termin√©es** dans les analyses √† venir.

#### Analyse pr√©liminaire de la variable `Age` :

Comme mentionn√© pr√©c√©demment, l‚Äô**√¢ge moyen des passagers est de 29,88 ans**, avec un **√©cart-type de 14,41 ans**, ce qui indique une **dispersion mod√©r√©e** autour de la moyenne.\

La distribution semble **centr√©e**, traduisant une certaine **sym√©trie autour de la valeur centrale**, mais on observe n√©anmoins la pr√©sence de **valeurs atypiques**, notamment au-del√† de **70 ans**.\

Ces **valeurs extr√™mes** sont visibles sur la figure 3

```{r,message=FALSE,warning=FALSE,fig.cap="Figure 3 : Distribution des ages parmis les passagers du titanic"}
library(e1071)

skew <- skewness(df$Age, na.rm = TRUE)
kurt <- kurtosis(df$Age, na.rm = TRUE)
moy <- mean(df$Age,na.rm = TRUE)

df |> ggplot(aes(x=Age))+
  geom_histogram(bins=30,alpha=0.8,fill=Colors[1])+
  geom_vline(
    aes(xintercept = moy,
        color="Moyenne"),
        linetype="dashed",
        linewidth=0.6
    )+
  scale_color_manual(
    name ="L√©gende",
    values = c("Moyenne"="black" )
    )+
  annotate("text", x = 50, y = 80, label = paste0("Skewness : ", round(skew, 2)), hjust = 0, size = 4)+ 
  annotate("text", x = 50, y = 75, label = paste0("Kurtosis : ", round(kurt, 2)), hjust = 0, size = 4)+
  annotate("text",x = moy + 10, y = 120 , label=paste0(round(moy,2),"ans"))+
  labs(y= "Nombre de personnes",
       title = "Distribution des √¢ges des passagers du titanic")+
  theme_ipsum(base_family = "Georgia",plot_title_family = "Times New Roman")
  # annotate("text",x = 25,y=90,label="Moyenne")


```

Int√©ressons-nous maintenant √† la variable **`Pclass`**, qui repr√©sente la classe du billet achet√© par chaque passager comme √©voqu√© en introduction, cette variable est comparable aux classes dans un avion : les passagers de 1re classe b√©n√©ficient de meilleures conditions et paient un tarif √©lev√©, tandis que ceux des classes inf√©rieures (2e et 3e) acc√®dent √† des services plus restreints pour un prix plus abordable.

La variable **`Pclass`** est une variable cat√©gorielle ordinale comportant trois niveaux : 1, 2 et 3, correspondant respectivement aux 1re, 2e et 3e classes. Le graphique ci-dessous illustre la r√©partition des passagers par classe, et permet d‚Äôobserver la proportion relative de chaque cat√©gorie dans l‚Äô√©chantillon.

```{r}

df |> ggplot(aes(x=Pclass))+
  geom_bar(aes(fill=Pclass))+
  scale_fill_viridis_d()+
  labs(y="Nombre de personnes",
       title = "R√©partition des class en fonction des passagers",
       x="Classe")+
  theme_ipsum(base_family = "Georgia",plot_title_family = "Times New Roman")+
  geom_text(
    stat = "count",
    aes(label=scales::percent(after_stat(count)/nrow(df))),
    vjust=-0.5 
    )
```

La majorit√© des passagers se trouvent dans la **3e classe**, qui repr√©sente **54,3 %** de l‚Äô√©chantillon total.\
Ce r√©sultat n‚Äôest pas surprenant : comme √©voqu√© dans l‚Äôanalyse de la variable `Fare`, les prix des billets sont **fortement concentr√©s autour des faibles valeurs**, ce qui s‚Äôexplique par une **asym√©trie tr√®s marqu√©e √† droite** (skewness √©lev√©e et positive). Cette concentration autour des petits montants correspond typiquement √† des **billets de 3e classe**, propos√©s √† des tarifs plus accessibles, tandis que les **valeurs extr√™mes** observ√©es dans la distribution (prix sup√©rieurs √† 200 ¬£) concernent probablement les **billets de luxe** de 1re classe ou 2e classe . La **2e classe** repr√©sente **21,2 %** des passagers, tandis que la **1re classe** en regroupe **24,7 %**, ce qui refl√®te une r√©partition relativement coh√©rente avec les diff√©rences de prix et de services offerts entre les classes sociales √† bord du **`Titanic`**

Ces diff√©rences de classes se refl√®tent logiquement dans les prix des billets, que nous allons maintenant analyser plus en d√©tail √† travers la variable Fare.

### Analyse de la variable **`Fare`** 

Le **prix du billet** (`Fare`) constitue un **indicateur socio-√©conomique essentiel** dans l‚Äôanalyse du naufrage du Titanic.\
En effet, le montant pay√© d√©terminait **la classe du billet**, et donc **la zone d‚Äôh√©bergement √† bord du navire**. Or, qui dit **zone diff√©rente** dit aussi **acc√®s in√©gal aux structures de sauvetage**, notamment en fonction de la proximit√© aux canots ou aux ponts sup√©rieurs.

```{r}


library(e1071)

skew <- skewness(df$Fare, na.rm = TRUE)
kurt <- kurtosis(df$Fare, na.rm = TRUE)

df |> ggplot(aes(x=Fare))+
  geom_histogram(bins=30,fill=Colors[1],alpha=0.9)+
  geom_vline(
          aes(
              xintercept = mean(Fare,na.rm=T),
              colour="Moyenne"
             ),
          linetype="dashed",
          linewidth=0.8
            )+
  annotate("text", x = 300, y = 380, label = paste0("Skewness : ", round(skew, 2)), hjust = 0, size = 4)+
  annotate("text", x = 300, y = 355, label = paste0("Kurtosis : ", round(kurt, 2)), hjust = 0, size = 4)+
  labs(x="Prix du billet",
       y="Nombre de personnes",
       title = "R√©partition des prix des billets (en ¬£) du titanic",
       colour="")+
  scale_x_continuous(labels = scales::label_dollar(prefix = "",suffix = "¬£"))+
  theme +
   scale_color_manual(
    name ="L√©gende",
    values = c("Moyenne"="black")
    )+
  annotate("text",x=75,y=400,label=paste(round(mean(df$Fare,na.rm = T),3),"¬£"),color="red")
```

Le graphique ci-dessus illustre la **distribution des prix des billets**, r√©v√©lant une **forte fragmentation socio-√©conomique** parmi les passagers.\
On observe que la majorit√© des billets sont fortement concentr√©s autour de **20 ou de la moyenne ¬£**, ce qui correspond vraisemblablement aux **passagers de 3e classe**.\
Cependant, certains billets atteignent des montants bien plus √©lev√©s, allant jusqu‚Äô√† **512,33 ¬£**, laissant supposer que ces passagers b√©n√©ficiaient de **services de luxe**, de **cabines spacieuses**, voire d‚Äôun **statut privil√©gi√© √† bord**.

Afin de mieux comprendre le profil des passagers, il est pertinent de s'int√©resser √©galement √† la variable `Embarked`, qui indique **le port d'embarquement**. Celle-ci pourrait √™tre li√©e **au prix du billet**, voire √† la **classe sociale** des passagers

### Mise en lumi√®re de la variable **`Embarked`**

Lors de sa travers√©e, le Titanic a effectu√© deux escales apr√®s son d√©part de **Southampton** : la premi√®re √† **Cherbourg**, en **Normandie (France)**, et la seconde √† **Queenstown**, en **Irlande**. Le graphique ci-dessous illustre la **r√©partition des passagers selon leur port d‚Äôembarquement**, ce qui permet de visualiser la contribution de chaque escale √† la composition globale des passagers √† bord.

```{r}
df <- df |> 
  mutate(
    Embarked= if_else(Embarked=="",NA_character_,Embarked)
  )

df |> mutate(Embarked = fct_explicit_na(Embarked,"Inconnue")) |> 
  ggplot(
    aes(
      x=fct_reorder(Embarked,Embarked,.fun=function(x)length(x),.desc = T),
      fill=Embarked)) +
  geom_bar()+
  scale_fill_viridis_d(
    name="Port d'embarquement",
    label=c(
        "C" = "Cherbourg",
        "Q" = "Queenstown",
        "S" = "Southampton"
)
  )+
  labs(x="Port",
       y="Nombre de personnes",
       title="R√©partitions des port d'embarquement en fonction des passagers"
       )+
  ggt+
   theme  

```

Il est tout √† fait naturel d‚Äôobserver une **forte concentration des embarquements √† Southampton**, puisque c‚Äôest depuis ce port que le Titanic a **d√©but√© sa travers√©e**. En effet, pr√®s de **70 % des passagers ont embarqu√© √† Southampton**, contre **23 % √† Cherbourg** (en France), et seulement **9 % √† Queenstown** (en Irlande), qui constituait la derni√®re escale avant la travers√©e de l‚ÄôAtlantique

```{r}

df |> 
  group_by(`Nombre de parents et/ou enfants a bord`=Parch) |> 
  summarise(
    Effectif = n(),
    Proportion = paste(round(Effectif / nrow(df),3)*100,"%")
                ) |> reactable::reactable()
```

Parmi les passagers du `Titanic` 76.5 % voyage sans leurs enfants et ou leurs parents contre 13% qui voyage avec un seul parent ou enfant

```{r}
df |> 
  group_by(`Nombre de  fr√®re ou s≈ìur et/ou de conjoint a bord`= SibSp) |>
  mutate(`Nombre de  fr√®re ou s≈ìur et/ou de conjoint a bord` =case_when(
    SibSp > 2 ~"+2",
    SibSp==1 ~ "1",
    SibSp == 2 ~ "2",
    SibSp ==0 ~"0"
  )) |> 
   summarise(
    Effectif = n(),
    Proportion = paste(round(Effectif / nrow(df),3)*100,"%")
                ) |> 
  arrange(desc(Effectif)) |> 
reactable::reactable()
```

68,1‚ÄØ% des passagers voyageaient sans conjoint ni fr√®re ou s≈ìur, contre 24,4‚ÄØ% accompagn√©s d‚Äôun proche familial (fr√®re, s≈ìur ou conjoint)

## Analyse bivari√©e

```{r}
df <-df |> mutate(
  Categorie_age = case_when(
    Age >=0 & Age < 12 ~ "Enfant",
    Age >=12 & Age < 19 ~ "Adolescents",
    Age >= 19 & Age < 26 ~ "Jeune adulte",
    Age >= 26 & Age < 60 ~ "Adulte",
    Age >= 60 ~ "Senior",
    TRUE ~ NA_character_
    
  ),
  Categorie_age = as.factor(Categorie_age)
)
```

```{r}
# table(df$Categorie_age,useNA = "ifany")
# 
# reactable::reactable(
#   df |> 
#     group_by(
#       `Tranche d'age`=fct_explicit_na(Categorie_age,"Inconnu")
#       ) |> 
#     summarise(`Nombre de personnes` =n()) |> 
#     arrange(desc(`Nombre de personnes`))
#   # )
```

### **‚ÄúLes femmes et les enfants d'abord‚Äù : une r√®gle respect√©e √† bord du `Titanic` ?**

En situation de crise, il est fr√©quent que **les femmes et les enfants soient prioritaires lors des √©vacuations**, et le cas du `Titanic` ne fait pas exception √† cette r√®gle.

Le graphique ci-dessous nous montre que, **parmi les passagers ayant surv√©cu**, **68,1‚ÄØ% √©taient des femmes** contre **31,9‚ÄØ% d‚Äôhommes** (en ne consid√©rant que les donn√©es connues).

√Ä l‚Äôinverse, **parmi les passagers d√©c√©d√©s**, **85,2‚ÄØ% √©taient des hommes**, et seulement **14,8‚ÄØ% √©taient des femmes**, ce qui sugg√®re un **fort d√©s√©quilibre selon le sexe**.

```{r}
A <- df |>
  filter(!is.na(Survived)) |> 
  count(Sex , Survie_Na) |> 
  group_by(Survie_Na) |> 
  mutate(Total = sum(n),
         percent = n/ Total) |> 
  ggplot(aes(x = Sex ,y = n ,fill =Survie_Na))+
  geom_col()+
  scale_fill_viridis_d(name = "Statut")+
  theme+
  labs(subtitle="La repartion du statut en fonction du genre",
       y = "Nombre de personnes" ,
       title= "",
       x =" Genre")+
  geom_text(aes(
                label = scales::percent(percent)
                ) ,
            position = position_stack (vjust=0.5) , color = "white",
            fontface="bold.italic" , 
            family = "serif"
  )+
  theme(legend.position="top")



B <-  df |>
  filter(Survie_Na %in% c( 1,0)) |> 
  count(Sex , Survie_Na) |> 
  group_by(Sex) |> 
  mutate(Total = sum(n),
         percent = n/ Total) |> 
  ggplot(aes(x = Sex ,y = n ,fill =Survie_Na))+
  geom_col()+
  scale_fill_viridis_d(name = "Statut")+
  theme+
  labs(subtitle="La repartion du genre en fonction du statut",
       y = "Nombre de personnes" ,
       title="",
       x =" Genre")+
  geom_text(aes(
                label = scales::percent(percent)
                ) ,
            position = position_stack (vjust=0.5) , color = "white",
            fontface="bold.italic" , 
            family = "serif"
  )+
  theme(legend.position="top")
     
library(gridExtra)
grid.arrange(A,B,ncol=2)
           
```

Une question se pose alors :\
*Ce d√©s√©quilibre s'explique-t-il par le fait que les hommes √©taient majoritaires √† bord du **`Titanic`**, ou bien refl√®te-t-il une in√©galit√© r√©elle face √† la survie ?*

Pour r√©pondre rigoureusement √† cette question, nous allons utiliser un **test du khi¬≤ d‚Äôind√©pendance**, afin de d√©terminer si le **sexe et la survie sont statistiquement li√©s** ou si la diff√©rence observ√©e pourrait √™tre due au hasard puis nous allons mesure

```{r}

# B <-  df |>
#   filter(Survie_Na %in% c( 1,0)) |> 
#   count(Sex , Survie_Na) |> 
#   group_by(Sex) |> 
#   mutate(Total = sum(n),
#          percent = n/ Total)
cat("le test de khi-deux nous renvoie : \n")
cat("------------------------------------------------------------------------------------")
chisq.test(table(df$Survived,df$Sex)) # Elle sert a quantifier la force du lien entre deux variables cat√©gorielles
cat("------------------------------------------------------------------------------------\n")
cat("Et le V de cramer est de " ,as.numeric(cramerV(table(df$Survived,df$Sex))))

```

Le **test du Chi¬≤** a r√©v√©l√© une **association statistiquement significative** entre le **sexe des passagers** et leur **probabilit√© de survie** (œá¬≤ = 257,27 ; p-value \< 2.2e-16). De plus, l‚Äô**indice de V de Cram√©r**, √©gal √† **0,54**, indique une **association forte** entre ces deux variables. Cela sugg√®re que le **sexe constitue un facteur d√©terminant** dans les chances de survie lors du naufrage du Titanic.

En appui √† ces r√©sultats statistiques, le **graphique ci-dessous** met en √©vidence un **d√©s√©quilibre marqu√© entre les proportions d‚Äôhommes et de femmes** dans les diff√©rentes **tranches d‚Äô√¢ge** : les femmes sont globalement **sous-repr√©sent√©es** dans toutes les cat√©gories. Toutefois, le second graphique montre que, **quel que soit l‚Äô√¢ge**, les **femmes pr√©sentent un taux de survie syst√©matiquement plus √©lev√©** que les hommes. Cette observation visuelle renforce l‚Äôhypoth√®se selon laquelle les **femmes ont √©t√© prioris√©es** lors de l‚Äô√©vacuation, en application du principe du **"women and children first"**, historiquement document√© pendant le naufrage.

```{r}
library(ggtext)
A <- df |> 
  count(Categorie_age,Sex) |> 
  group_by(Categorie_age) |> 
  mutate(Total = sum(n),
         percent = n/Total) |> 
  ggplot(aes(x = Categorie_age , y=n ,fill=Sex)) + 
  geom_col()+
  # facet_grid(Survived ~.)+
    geom_text(
    aes(label = scales::percent(percent, accuracy = 1)),
    position = position_stack(vjust = 0.5),
    color = "gray65",
    size =4
  )+
  scale_fill_viridis_d()+
   labs(subtitle = "R√©partition des tranches d‚Äô√¢ge selon le sexe des passagers " ,
       y = "Nombres de personnes " , 
       title = "Comparaison de la r√©partition des passagers et des survivants selon l'√¢ge et le sexe",
       x ="Tranche d'√¢ge")+
  theme+
  theme(legend.position="top")


B <- df |> 
  filter(Survived == 1 )|>
  count(Sex , Categorie_age , Survived) |> 
  group_by(Categorie_age) |> 
  mutate(Total = sum(n) , 
         percent = n / Total) |> 
  ggplot(aes( x = Categorie_age , y = n ,fill = Sex))+
  geom_col()+
  theme +
  scale_fill_viridis_d(name = "Genre") +
  labs(subtitle = "Structure des survivants par genre et tranche d‚Äô√¢ge " ,
       title="",
       y = "Nombres de personnes " , 
       x ="Tranche d'√¢ge")+
  geom_text( aes(label = scales::percent(percent) ),
            position = position_stack (vjust=0.6) , color = "gray65",
            fontface="bold.italic" , 
            family = "serif" ,
            size =4) + 
   theme(
    legend.position = "top",
  )


grid.arrange(A,B,ncol = 2)

```

```{r}
df |> ggplot(aes(x=Fare,fill=Survie_Na))+
  geom_density(aes(y=..density..),alpha=0.6)+
  scale_fill_viridis_d(name="Statut")+
  labs(y="Densit√© ",
       x= "Prix du billet",
       title = " Distribution de la densit√© du prix des billets en fonction du statut des passagers")+
  theme 
```

-   Les distribution sont assez identique elles suivent toute la m√™me tendance :
    -   La plupart des billets ont √©taient achet√©s autour de 25¬£ car c'est le prix auquel la densit√© est maximal
    -   Un deuxi√®me pic (moins importante que la 1er ) est observ√© aux alentour de 75¬£
    -   Ont observe √©galement des valeurs extr√™me des billets qui ont √©taient vendus a + 200 ¬£

```{r}
# table(df$Cabin=="")
df <- df |> 
  mutate(Cabin = if_else(Cabin=="",NA_character_,Cabin))
```

# [Test statistique]{.underline}

Dans cette partie nous allons faire des test de significativit√© afin d'apprendre d'avantage sur les diff√©rences (potentiellement existantes) entre les diff√©rentes caract√©ristiques de la base donn√©e avec la variable cible ( **`Survivived)`**

**Existe-t-il des diff√©rences prix en fonction du statut ?**

> Nous utilisons le test de `Kruskal-Wallis` pour √©valuer s‚Äôil existe **des diff√©rences significatives dans la distribution des prix des billets (`Fare`) selon le statut de survie des passagers**. Le test permet de r√©pondre √† la question : **‚ÄúLe prix du billet varie-t-il en fonction du fait qu‚Äôun passager ait surv√©cu ou non ?‚Äù**

```{r}
ggstatsplot::ggbetweenstats(
  data = df ,
  title = "Comparaison des distributions des prix des billets en fonction du statut" ,
  # caption =  ,
  xlab = "Statut" ,
  ylab ="Prix des billets"  ,
  x = Survie_Na ,
  y = Fare  ,
  type = "non-parametric",
  ggtheme = theme # deja construis 
)+
  scale_fill_viridis_d()
```

-   Le test de Kruskal-Wallis indique que les prix des billets diff√®rent significativement selon le statut des passagers (p \< 0.001 )
-   Les comparaisons par paires √† l‚Äôaide du test de **`Dunn`**, avec correction de **`Holm`**, confirment des diff√©rences significatives entre chacun des groupes
-   Cependant vu que l'effet $\hat{\epsilon}^2_{ordinal} = 0.07$ cela sugg√®re que les diff√©rences existe bel et bien mais elles sont **mod√©r√©es**.Ces diff√©rences sont statistiquement significatives, m√™me apr√®s correction des p-values (m√©thode de [**`holm`**]{.underline}**)** pour comparaisons multiples

Analysons maintenant si la distribution de l'√¢ge en fonctions du statut est significativement diff√©rente ou pas , cela nous permettrait de savoir si l'age des individus ont p√ªt influencer ou pas le statut des individus.

Pour cela nous allons faire un test de **Welch**

```{r}
 ggstatsplot::ggbetweenstats(
   x= Survived ,
   type ="parametric",
   y = Age ,
   data = df
 )
```

Les survivants avaient un **age moyen de 28.34 ans contre 30.63 ans** pour les non-survivants. Bien que la diff√©rence d‚Äô√¢ge moyen soit faible, le test de **Welch** nous dit que la diff√©rence est significative (probabilit√© critique \< 5% mais \> 1%) . Cela sugg√®re que **l‚Äô√¢ge pourrait jouer un r√¥le mod√©r√© dans la probabilit√© de survie**. Toutefois, la **taille de l‚Äôeffet**, mesur√©e par l‚Äôindice de `Hedges` $\hat{g}_{Hedges} = 0.16$ est consid√©r√©e comme **faible** selon la r√®gle de Cohen

Nous allons maintenant analyser la relation entre la classe des passagers (`Pclass`) et leur probabilit√© de survie.

```{r,warning=FALSE}
A <- df |> 
  count(Pclass,Survie_Na) |> 
  group_by(Pclass)  |>
  mutate(
    total = sum(n),
    pourcentage = n / total
  ) |> 
  ungroup() |> 
  ggplot(aes(x=Pclass,y=n,fill=Survie_Na))+
  geom_col()+
  scale_fill_viridis_d()+
  labs(y="Nombre de personnes",
       subtitle = "Informations total",
       x="Classe",
       fill = "Statut",
       title = "R√©partition des classes en fonction du statut")+
theme+ 
  geom_text(
    aes(label = scales::percent(pourcentage, accuracy = 1)),
    position = position_stack(vjust = 0.5),
    color = "gray65",
    size = 4
  )+
  theme(legend.position = "top")
  



B <- df |> 
  select(Pclass,Survived) |> 
  na.omit() |> 
  count(Pclass,Survived) |> 
  group_by(Pclass)  |>
  mutate(
    total = sum(n),
    pourcentage = n / total
  ) |> 
  ungroup() |> 
  ggplot(aes(x=Pclass,y=n,fill=Survived))+
  geom_col()+
  scale_fill_manual(values = c("#440154FF" ,"#21908CFF" ))+
  labs(y="Nombre de personnes",
       subtitle  = "Zoom sur l'information connue",
       title="",
       x="Classe",
       fill = "Statut")+
theme+ 
  geom_text(
    aes(label = scales::percent(pourcentage, accuracy = 1)),
    position = position_stack(vjust = 0.5),
    color = "gray65",
    size = 4
  )+
  theme(legend.position = "top")

library(patchwork)

gridExtra::grid.arrange(A,B,ncol=2)

# viridis::viridis(3)
# "#440154FF" "#21908CFF" "#FDE725FF"
```

D‚Äôapr√®s les donn√©es disponibles, on observe que les passagers de **1re classe** pr√©sentaient un **taux de survie nettement plus √©lev√©** que ceux des classes inf√©rieures.\
En effet, **42 % des passagers de 1re classe ont surv√©cu**, contre **31 % en 2e classe** et seulement **17 % en 3e classe**.

√Ä l‚Äôinverse, la **classe tertiaire (3e classe)** enregistre un **taux de mortalit√© particuli√®rement √©lev√©** : **52 %**, contre **35 % en 2e classe** et seulement **25 % en 1re classe**.

Ces chiffres sugg√®rent une possible **in√©galit√© d‚Äôacc√®s aux moyens de sauvetage** selon la classe sociale.\
Cela soul√®ve une **hypoth√®se importante** :

> *Le fait d‚Äôappartenir √† une classe sup√©rieure augmente-t-il r√©ellement les chances de survie, ou cette diff√©rence n‚Äôest-elle qu‚Äôun artefact d√ª √† la **r√©partition d√©s√©quilibr√©e des passagers** entre les classes ?*

Cette question justifie la mise en ≈ìuvre d‚Äôun **test statistique d‚Äôind√©pendance**, afin de d√©terminer si la variable `Pclass` est **statistiquement associ√©e au statut de survie**, au-del√† de simples diff√©rences d‚Äôeffectifs.

Cette analyse vise √† d√©terminer si la **classe sociale des passagers**, repr√©sent√©e par la variable `Pclass`, a eu un **impact significatif sur leur probabilit√© de survie**. Comprendre cette relation permet d‚Äô**√©valuer l‚Äôinfluence des in√©galit√©s sociales** dans les chances de survie lors du naufrage du Titanic.

```{r}
khi_deux <- chisq.test(table(df$Survived,df$Pclass)) 


# pairwise_khi <- FSA::dunnTest(as.numeric(df$Survie_Na),df$Pclass)

pairwise_khi <- rcompanion::pairwiseNominalIndependence(table(df$Pclass, df$Survived),
                                        fisher = F,
                                        method = "holm")

cat("Le test de khi deux nous renvoie :")
cat("")
khi_deux

cat("Les tests de significativit√©s (post-hoc) par paires \n avec la m√©thode de fisher et un ajustement des probabilit√© critique avec la m√©thode de holm:")
pairwise_khi |> pander::pander()

```

Afin d‚Äôidentifier plus pr√©cis√©ment les diff√©rences entre les classes de passagers, nous avons effectu√© des **comparaisons par paires** entre les modalit√©s de la variable `Pclass`, √† l‚Äôaide du **test post-hoc du Chi¬≤** (`pairwiseNominalIndependence`), avec une **correction des p-values selon la m√©thode de Holm**.

Les r√©sultats montrent que :

-   Il existe une **diff√©rence significative entre la 1re et la 2e classe** (**`p-value`** ‚âà 0.001), indiquant une variation claire des taux de survie entre ces deux groupes.

-   La **diff√©rence entre la 1re et la 3e classe est particuli√®rement marqu√©e**, ce qui confirme l‚Äôhypoth√®se d‚Äôune **in√©galit√© d‚Äôacc√®s aux moyens de sauvetage**. Les passagers de 1re classe √©taient probablement **mieux situ√©s**, avec des cabines plus proches des **ponts sup√©rieurs** ou des **canots de sauvetage**, facilitant leur √©vacuation.

-   Un **√©cart significatif** est √©galement observ√© entre la **2e et la 3e classe**, dans le m√™me sens.

> Ces r√©sultats confirment que **la probabilit√© de survie varie significativement selon la classe du passager**. En particulier, les passagers de 1re classe ont un **taux de survie nettement sup√©rieur** √† ceux des 2e et 3e classes.
>
> Cela renforce l‚Äôhypoth√®se d‚Äôune **in√©galit√© structurelle li√©e √† la classe sociale**, influant sur les **conditions d‚Äô√©vacuation** et l‚Äô**acc√®s aux dispositifs de sauvetage**, lors du naufrage du **`Titanic`**.

#### Le taux de survie varie-t-il selon le port d‚Äôembarquement ?

Autrement dit, la **probabilit√© de survie** des passagers du **`Titanic`** **d√©pend-elle du lieu depuis lequel ils ont embarqu√©** ? Cette question soul√®ve la possibilit√© d‚Äôun **contexte g√©ographique ou logistique** ayant influenc√© l‚Äô√©vacuation.

Comme √©voqu√© pr√©c√©demment, environ **70 % des passagers ont embarqu√© √† Southampton (Angleterre)**, **23 % √† Cherbourg (France)**, et **9 % √† Queenstown (Irlande)**.\
L‚Äôobjectif est maintenant de **calculer, pour chaque port**, le **taux de survie et le taux de d√©c√®s** parmi les passagers, afin d‚Äôidentifier d‚Äô√©ventuelles **disparit√©s selon l‚Äôorigine g√©ographique**.

```{r}
df |>  filter(!is.na(df$Survived)) |> 
  count(Embarked , Survived) |> 
  group_by(Embarked) |> 
  mutate(Total = sum(n),
        percent = n / Total) |> 
  ggplot(aes(x=reorder(Embarked,percent) , y = n , fill =Survived ))+
  geom_col()+
  scale_fill_viridis_d()+
  labs(title = "Repartition du statut en fonction du port d'embarquement",
       x = " Port d'embarquement " , 
       y= "Nombre de personne")+
  geom_text(aes(label = percent(percent)),
            position = position_stack(vjust=0.5) , 
            color = "gray65")+
  theme
```

Le graphique ci-dessus montre que les taux de survie varient sensiblement selon le port d‚Äôembarquement.

Les passagers ayant embarqu√© √† **`Cherbourg (port C)`** pr√©sentent le taux de survie le plus √©lev√©, avec 55,4 % de survivants ‚Äî soit pr√®s d‚Äôune personne sur deux.

√Ä l‚Äôinverse, les passagers partis de **`Southampton (port S)`** affichent un taux de survie plus faible, √† 33,8 %, tandis que ceux de **`Queenstown (port Q)`** atteignent 39 %.

Ces √©carts pourraient refl√©ter des diff√©rences de statut social, de conditions d‚Äôembarquement ou encore de localisation √† bord du navire selon le port d‚Äôorigine.

**Cependant** il est √©galement important de noter que **le port de `Southampton` repr√©sentait plus de 70 % des embarquements**.

Ainsi, m√™me si son **taux de survie** est **plus faible** que celui observ√© √† Cherbourg, cela peut aussi s‚Äôexpliquer par le **nombre beaucoup plus important de passagers** ayant embarqu√© depuis ce port.\

Cette surrepr√©sentation **amplifie m√©caniquement** l‚Äôimpact des survivants et des victimes issus de **`Southampton`** dans les statistiques globales

# [Gestion des Valeurs manquantes]{.underline}

## [Gestion des valeurs manquantes]{.underline}

La gestion des valeurs manquantes est une √©tape **essentielle en analyse de donn√©es**, car elle permet d‚Äô**affiner les r√©sultats** en estimant des valeurs absentes de mani√®re coh√©rente. Cela nous aide √† nous rapprocher des **valeurs r√©elles** que l‚Äôon aurait pu observer dans la population ou l‚Äô√©chantillon √©tudi√©.

Cependant, toutes les techniques d‚Äôimputation **ne garantissent pas la fiabilit√©** des r√©sultats : chaque situation ou type de donn√©es n√©cessite **une m√©thode d‚Äôimputation adapt√©e**.

Dans cette partie, nous allons tester **diff√©rentes strat√©gies d‚Äôimputation** afin de mieux g√©rer les donn√©es manquantes et d‚Äô**enrichir notre base de donn√©es**, dans le but d‚Äôam√©liorer les performances des mod√®les de machine learning

```{r}
Percent_NA <- round(
                    colSums(is.na(df |> 
                                   select(-c(Categorie_age,Survie_Na)) )
                          )/nrow(df),4
                    ) |> 
  sort(decreasing = T)|>
  as.data.frame()

colnames(Percent_NA) <- "Pourcentage des donn√©es manquantes"

Percent_NA |>
  reactable::reactable()
```

Comment allons nous imputer la variable ***`Age`***?

```{r}
# gg_miss_var(df)
```

```{r}
# micee <- mice(df, m = 1, seed = 123)
# make.method(df)                 # pour voir les m√©thodes par d√©faut
# df_imp <- complete(micee, 1)    # jeu de donn√©es compl√©t√©
# df$Age_mice <- df_imp$Age       # stocker la version imput√©e de Age
# 
library(mice)


# 1. As-tu bien lanc√© l'imputation ?
micee <- mice(df |> select(-c(Categorie_age,PassengerId,Survie_Na,Cabin)), m = 5, seed = 123)

#extraction du dataset complet (imput√©)
df_imp <- complete(micee, 3)

# 3. Est-ce qu'il reste des NA ?
# colSums(is.na(df))  # te montre combien de NA par variable

```

```{r}
# gg_miss_var(df)
df$Age_median <- df$Age
df$Age_moyen <-  df$Age
df$Age_mice <-  df_imp$Age

df$Age_median[is.na(df$Age_median)] <- median(df$Age,na.rm = T)
df$Age_moyen[is.na(df$Age_moyen)] <- mean(df$Age,na.rm = T)


```

```{r}
A <- df |> ggplot()+
  geom_density(aes(x=Age  ,fill= "Age" ),alpha= 0.5)+
  geom_density(aes(x= Age_median ,fill="Age_median"),alpha=0.5)+
  geom_density(aes(x= Age_moyen ,fill="Age_moyen"),alpha=0.6)+
  geom_density(aes(x= Age_mice ,fill="mice"),alpha= 0.3)+
  scale_fill_brewer(name ="Distribution",palette = "Dark2")+
  theme(legend.position = "top")


B <-  df |> ggplot()+
  geom_density(aes(x=Age,color="Age"  ),alpha=0.7,linewidth=1)+
  geom_density(aes(x= Age_mice ,fill="Mice"),alpha=0.4)+
  labs(subtitle = "Zoom sur la distribution")+
   scale_fill_manual(values = Colors[1])+
  theme(legend.position = "top")


A + B
```

On remarque que les imputations par la moyenne et la m√©diane modifient la distribution des √¢ges, contrairement √† l‚Äôimputation r√©alis√©e avec `mice`. Cette derni√®re utilise une r√©gression pour estimer les valeurs manquantes, puis s√©lectionne parmi les vraies valeurs observ√©es celles qui sont les plus proches. Elle pr√©serve ainsi l‚Äôallure g√©n√©rale de la distribution d‚Äôorigine, sans l‚Äôaplatir artificiellement

```{r}
df <- df|>  select(- c(Age_median,Age_moyen)) # on nettoye un peu en supprimant  qlq variable initule pour la suite 
```

Int√©ressons nous sur la `Cabin`

Ont pourrais √™tre tent√© de supprim√© la variable `Cabin` car elle offre pas assez d'informations 77,46% des donn√©es sont manquantes .

Avant de rentr√© en *`d√©tails`* sur les technique adapter a cette variable ont doit comprendre comment elle est construite ?

La variable **`Cabin`** indique la cabine attribu√©e √† chaque passager, g√©n√©ralement compos√©e d'une lettre repr√©sentant le pont du navire (**`Deck`**) suivie d‚Äôun num√©ro.

Bien que cette variable contienne de nombreuses valeurs manquantes, l'information extraite du pont peut r√©v√©ler des indices importants sur le statut social ou la position des passagers, et ainsi influencer leur probabilit√© de survie. (**`hypoth√®se`** )

```{r}
# df$Cabin_letter <- substr(df$Cabin, 1, 1) ou 
df <- df |> mutate(Deck = str_sub(Cabin,start = 1, end = 1),
                   Deck = as.factor(Deck))

table(df$Deck_imp)

```

```{r}
df_knn <- df |> 
  select(Deck, Pclass, Fare, Sex, Embarked)  # variables explicatives

```

```{r}
df_imp <- VIM::kNN(df_knn,
                   variable = 'Deck',
                   k=5 )
```

```{r}
df$Deck_imp <-  df_imp$Deck
```

```{r}


df |> count(Deck_imp , Pclass) |> 
  group_by(Deck_imp) |> 
  mutate(Total = sum(n),
         percent = n /Total) |> 
  ggplot(aes(x = Deck_imp ,y= n , fill = Pclass))+
  geom_col()+
  theme + 
  labs(title = "R√©partition des lettres de cabine (imputation KNN) \n en fonction de la  Classe" , 
       x = "Lettre de la cabine", 
       y = "Nombre de billet")+
  scale_fill_viridis_d(name = "Classe") + 
   geom_text(
    aes(label = scales::percent(percent, accuracy = 1)),
    position = position_stack(vjust = 0.7),
    color = "gray39",
    fontface="bold",
    family="Segoe",
    size = 1.9
  )
  
```

-   Apr√®s avoir fait l'amputation de la variable `Cabine` ont observe que les cabines A,B,E et C sont majoritairement constituer de passagers de classe 1
-   La classe F est un m√©lange des classe 3 et 2
-   Les r√©sultats montrent que les cabines commen√ßant par la lettre `G` sont exclusivement associ√©es √† la 3e classe.\
    Ce constat est coh√©rent avec l'organisation spatiale du `Titanic`, o√π les passagers de 3e classe √©taient log√©s dans les ponts les plus bas du navire, souvent proches des machines et des quartiers de l‚Äô√©quipage. (voir fin du rapport ) Cette observation renforce la **validit√© de l‚Äôimputation** et la **pertinence de la variable `Cabin` (ou de sa premi√®re lettre)** comme indicateur de la classe sociale √† bord.

Comme la variable `Deck_imp` est **√©troitement li√©e √† la classe (`Pclass`)** par construction (certaines lettres de cabines n‚Äôapparaissent que dans certaines classes), on peut supposer que **l‚Äôemplacement de la cabine pourrait avoir un effet indirect sur la probabilit√© de survie**.

En effet, les lettres des ponts (`A`, `B`, ..., `G`) correspondent √† la **stratification verticale du navire** :

-   Le **pont A** se situe au niveau sup√©rieur,

-   Puis viennent les ponts **B**, **C**, jusqu‚Äôau **pont G**, situ√© au niveau inf√©rieur.

**Hypoth√®se** : *Les passagers log√©s dans les ponts sup√©rieurs auraient eu un **acc√®s facilit√© aux structures d‚Äô√©vacuation** (canots de sauvetage), ce qui pourrait expliquer un taux de survie plus √©lev√©.*

Le graphique ci-dessous montre que les **ponts B, C, D et E affichent des taux de survie √©lev√©s**, respectivement **64.8 %**, **56.8 %**, **71.7 %** et **75 %**.\
Cette observation semble **confirmer en partie l‚Äôhypoth√®se**.

Toutefois, le **pont A**, qui est pourtant le plus haut, **n‚Äôaffiche pas un taux de survie particuli√®rement √©lev√©**. Cela pourrai √™tre d√ª par deux facteurs a mon avis :

Certaines **cabines du pont A** √©taient **√©loign√©es des points d‚Äô√©vacuation**, notamment celles situ√©es √† l‚Äôarri√®re ou sur les c√¥t√©s du navire ;

Tous les passagers **n‚Äôont pas r√©agi de la m√™me mani√®re** face √† la panique ou aux ordres d‚Äô√©vacuation. L‚Äôattitude individuelle reste un facteur important.

```{r}
df[!is.na(df$Survived),] |>            # 1. On garde uniquement les lignes o√π la survie est connue
  count(Deck_imp, Survived) |>         # 2. On compte le nombre de passagers par pont et par statut
  group_by(Deck_imp) |>                # 3. On regroupe par pont
  mutate(
    Total = sum(n),                    # 4. On calcule le total de passagers par pont
    pourcentage = n / Total            # 5. On calcule la proportion de survivants/non-survivants par pont
  ) |> 
  filter(Survived == 1) |> 
  arrange(pourcentage) |> 
  ggplot(aes(x = reorder(Deck_imp,pourcentage) , y = pourcentage))+
  geom_col(fill = "#440154FF")+
  scale_y_continuous(labels = scales::label_percent())+
  geom_text(aes(label = scales::percent(pourcentage)),
            vjust = 1.5 , 
            color = "gray65")+
  labs(
    title = " Taux de survie par Cabine (pont)" ,
    x = "Pont" 
  )+
  theme 


```

On note √©galement que les passagers log√©s dans les **ponts inf√©rieurs**, notamment **F** et **G**, pr√©sentent des **taux de survie inf√©rieurs √† 45 %**.\
Cette observation **renforce l‚Äôid√©e** que la **position des quartiers dans le navire** a pu jouer un r√¥le **discriminant dans l‚Äôacc√®s aux moyens de sauvetage**.

Afin de **v√©rifier cette hypoth√®se**, nous allons r√©aliser un **test statistique d‚Äôind√©pendance** entre les variables `Deck_imp` et `Survived`, afin de d√©terminer si la r√©partition du taux de survie **d√©pend significativement du pont occup√©**.

```{r}

# df[-which(df$Deck_imp=="T"),] # c'est pour trouver la position des ponts T
df <-  df[-which(df$Deck_imp=="T"),] # on e√©l√®ve le pont T car elle est inexistantil y'a que deux occurence (il est important de l'√©lev√©  du fait que les test de khi¬≤ devient tres vite instable lorsque qu 'une cellule est < 5 occurence)
df$Deck_imp <- droplevels(df$Deck_imp) # il faut supprimer le niveaux car meme si on supprime l'element T le niveau est tjr conserveconserv√© 
df$Deck <- droplevels(df$Deck)


cat("Le test de khi¬≤ nous renvoie :\n")
cat("------------------------------------------------------------------------------------------")
chisq.test(
  table(
    df$Deck_imp,
    df$Survived
  )
)
t <-  rcompanion::cramerV(df$Deck_imp , df$Survived)
cat("L'intensit√© de cette r√©lation mesur√© par la methode de V cramm√©r nous donne", as.numeric(t),"\n")
cat("------------------------------------------------------------------------------------------")


```

Le **test du Chi¬≤ d‚Äôind√©pendance** a √©t√© r√©alis√© pour √©valuer l‚Äôassociation entre le **pont (`Deck_imp`)** occup√© par les passagers et leur **statut de survie (`Survived`)**.

Le r√©sultat du test est le suivant :

√âtant donn√© que la **p-value** est **tr√®s largement inf√©rieure √† 0.001**, le test est **hautement significatif**.\
Cela signifie qu‚Äôil existe une **relation statistiquement significative entre le pont et la survie**.\
En d‚Äôautres termes, la **r√©partition des taux de survie varie significativement selon le pont occup√©** par les passagers, ce qui **soutient l‚Äôhypoth√®se selon laquelle la position verticale dans le navire a pu influencer les chances de survie**.

L‚Äô**intensit√©** de cette association, mesur√©e √† l‚Äôaide de la **V de Cram√©r**, est de **0.2223**.\
Cela correspond √† une **association mod√©r√©e**, sugg√©rant que **la position verticale dans le navire (le pont) a eu un impact non n√©gligeable sur les chances de survie**.

La variable **`Fare & Embarked`** contiennent peut de valeur manquantes resp (1 et 2 ) ont va juste les enlev√©s

# Conclusion EDA

Cette analyse exploratoire nous a permis de **mieux comprendre la structure, la qualit√© et les grandes tendances du jeu de donn√©es Titanic**.\

L‚Äôexploration des donn√©es a mis en √©vidence plusieurs **in√©galit√©s marquantes** dans les chances de survie des passagers.\
Les **femmes** pr√©sentaient un **taux de survie nettement plus √©lev√©** que les hommes, et les passagers de **1re classe** survivaient davantage que ceux des classes inf√©rieures.\
De m√™me, les passagers ayant embarqu√© √† **Cherbourg** affichaient une meilleure probabilit√© de survie, ce qui sugg√®re des **diff√©rences sociales ou d‚Äôemplacement √† bord** selon le port d‚Äôembarquement.\
La variable `Fare` √©tait **fortement asym√©trique**, avec une majorit√© de petits montants, mais quelques billets tr√®s chers, associ√©s √† des conditions de voyage plus favorables.\
Enfin, l‚Äô√¢ge semble jouer un r√¥le mod√©r√©, avec une **l√©g√®re tendance √† la survie chez les jeunes enfants et les jeunes adultes**, mais des disparit√©s moins marqu√©es dans les tranches d‚Äô√¢ge plus √©lev√©es.
Les **tests statistiques** effectu√©s (Chi¬≤, test de Welch, V de Cram√©r‚Ä¶) ont confirm√© que plusieurs de ces variables pr√©sentent une **association significative** avec la variable cible `Survived`, ce qui justifie leur **prise en compte dans la phase de mod√©lisation** √† venir.\

```{r}

df <- df[-which(is.na(df$Embarked) | is.na(df$Fare)),] # supprime les lignes o√π Fare & embarked ont des valeurs manquantes
# colSums(is.na(df)) verification 
```

### [source & credit]{.underline}

T[itanic - L‚Äôapprentissage automatique √† partir d‚Äôun d√©sastre \| Kaggle](https://www.kaggle.com/c/titanic/data) [ici](https://www.kaggle.com/c/titanic/data "jeu de donn√©e")

[Naufrage du Titanic ‚Äî Wikip√©dia](https://fr.wikipedia.org/wiki/Naufrage_du_Titanic)

[√âchafaudage en coupe de l‚ÄôOlympic et du Titanic diagram.png - Wikimedia Commons](https://commons.wikimedia.org/wiki/File:Olympic_%26_Titanic_cutaway_diagram.png)

[Diff√©rence entre l‚Äôasym√©trie et l‚Äôaplatissement \| GeeksforGeeks](https://www.geeksforgeeks.org/difference-between-skewness-and-kurtosis/)

[photo introduction](https://www.google.com/imgres?imgurl=https://preview.redd.it/yzntfr5k4qre1.jpeg?width%3D640%26crop%3Dsmart%26auto%3Dwebp%26s%3D34965064f764a21bc31ed1b70ca258d231254e45&tbnid=RbLtP2lTKC3o8M&vet=1&imgrefurl=https://www.reddit.com/r/titanic/comments/1jn0scz/chat_gpt_ghibli_style_titanic/?tl%3Dfr&docid=sZNThHr0b672TM&w=640&h=426&itg=1&hl=fr-us&source=sh/x/im/m1/3&kgs=4bf48847522292a9)

[![](images/clipboard-3478795282.png){fig-align="center" width="791" height="706"}](https://www.alamy.com/stock-photo/titanic-diagram.html)

\

```{r}
# imputed <- mice(df_knn, m = 6, seed = 123,method = meth)
# dd <- complete(imputed,2)
# # make.method(df_knn)
# # # Cr√©er la liste des m√©thodes d‚Äôimputation
# # meth <- make.method(df_knn)
# # 
# # # Appliquer la m√©thode "logreg" √† la variable Sex
# # meth["Sex"] <- "logreg"

```
